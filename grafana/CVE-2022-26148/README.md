# CVE-2022-26148 Grafana api_jsonrpc.php Zabbix Credentials Disclosure

When using Grafana `7.3.4` (or older versions) integrated with Zabbix via
`alexanderzobnin-zabbix-app` plugin, the Zabbix username and password can be
leaked by directly inspecting the `html` source of the Grafana website's welcome page.

This is possible if:

- Grafana anonymous access is permitted, even if the permission level is set to `Viewer`
- the password field is mistakenly included inside the `jsonData` object of the
  `datasource.yml` configuration file, instead of the correct `secureJsonData`
  (older version of the `alexanderzobnin-zabbix-app` may not contain the `secureJsonData` field).

When credentials are placed in `jsonData`, they become accessible in the frontend.

The case outline above also holds for older versions of Grafana, with a slightly different
target URL. For example, the welcome page of Grafana version `v4.1.2` is `/login`.

## Setup

```shell
# inside the testbed folder
docker compose up
```

> Zabbix was not included in the `docker-compose.yml` because it isn't directly required to setup the vulnerability.

Both a vulnerable and non-vulnerable service will be created,
the vulnerable one at port `3000`, the non-vulnerable one at port `3001`.

## Credential leak test

vulnerable:

```shell
curl --request GET http://localhost:3000/?orgId=1 | grep '"password":'
```

non-vulnerable:

```shell
curl --request GET http://localhost:3001/?orgId=1 | grep '"password":'
```
