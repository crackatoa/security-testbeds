#!/usr/bin/env sh

echo ""
echo "[INFO] - Stopping docker compose"
echo "-------------------------------------"
docker compose -f docker-compose.yml down

echo "[INFO] - Building docker images"
cd zimbra-not-vuln-8.8 && docker build -t zimbra-not-vuln . && cd ..
cd zimbra-vuln-8.7 && docker build -t zimbra-vuln . && cd ..

echo ""
echo "[INFO] - Starting docker compose"
echo "-------------------------------------"
docker compose -f docker-compose.yml up -d

echo ""
echo "[INFO] - Installing zimbra vulnerable (v8.7.1)"
echo "----------------------------------------"
docker exec -it zimbra-vuln bash -c "./start.sh"

echo ""
echo "[INFO] - Installing zimbra not vulnerable (v8.8.15)"
echo "----------------------------------------"
docker exec -it zimbra-not-vuln bash -c "./start.sh"
